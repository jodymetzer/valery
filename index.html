<!DOCTYPE html>
<html lang="en">
<head>

  <!-- Basic Page Needs
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta charset="utf-8">
  <title>Valery</title>
  <meta name="description" content="">
  <meta name="author" content="yanis bourial">

  <!-- Mobile Specific Metas
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- FONT
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">

  <!-- CSS & JS
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="stylesheet" href="/css/normalize.css">
  <link rel="stylesheet" href="/css/slider.css">
  <link rel="stylesheet" href="/css/skeleton.css">
  <script src="https://code.jquery.com/jquery-1.11.1.js"></script>

  <!-- Favicon
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="icon" type="image/png" href="images/favicon.png">

</head>
<body>
  <script>
    var started=false;
    $(function(){
      $('#settings').hide();
      $(".toggler").on("click", function(){
          $(this)
          .toggleClass("expander expanded")
          $('#settings').slideToggle();
      });
    });
    
    $(function(){
      $('#progress').hide();
      $('#warning').hide();
      $("#start").on("click", function(){
        $('#main-ui').slideToggle();
        $('#progress').slideToggle();
        $('#warning').slideToggle();
        $("#reset").removeAttr("disabled");
        $("#start").attr("disabled", "disabled");
        started = true;
      });
    });
    
    $(function(){
      $("#reset").on("click", function(){
        $('#main-ui').slideToggle();
        $('#progress').slideToggle();
        $('#warning').slideToggle();
        $("#start").removeAttr("disabled");
        $("#reset").attr("disabled", "disabled");
      });
    });
    
    $(document).ready(function() {
      $('#clicker').click(function() {
          $('#rotating').toggleClass('rotated');
      });
    }); 
    
    $(function(){
      $(window).resize(function(){
          placeFooter();
      });
      placeFooter();
      // hide it before it's positioned
      $('#footer').css('display','inline');
    });

    function placeFooter() {    
      var windHeight = $(window).height();
      var footerHeight = $('#footer').height();
      var offset = parseInt(windHeight) - parseInt(footerHeight);
      $('#footer').css('top',offset);
    }
  </script>
  <!-- Primary Page Layout
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <div class="container" >
    <div class="row">
      <div style="margin-top: 25%">
        <h3>valery</h3>
        <p>connecté à : <i>127.0.0.1/not-a-raspberry</i></p>
      </div>
      <div class="message" style="overflow: auto; height: 100px;">
        <div>salut</div>
        <div>salut</div>
        <div>salut</div>
        <div>salut</div>
        <div>salut</div>
        <div>salut</div>
      </div>
      <div id="main-ui">
      <a class="toggler expander" style="border:none;" id="clicker"><span id="rotating" style="display: inline-block;">▾</span> Paramètres</a>
        <div id="settings">
          <div id="slider">
            <div class="range-slider">
              <label style="padding-bottom: -20px;">vitesse : </label>
                <input id="speed" class="range-slider__range" type="range" value="0" min="0" max="100">
              <span class="range-slider__value">0</span><span>%</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="row" id="progress">
      <svg width='50px' height='50px' xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" class="uil-ripple">
         <rect x="0" y="0" width="100" height="100" fill="none" class="bk"></rect>
         <g>
            <animate attributeName="opacity" dur="2s" repeatCount="indefinite" begin="0s" keyTimes="0;0.33;1" values="1;1;0"></animate>
            <circle cx="50" cy="50" r="40" stroke="#afafb7" fill="none" stroke-width="6" stroke-linecap="round">
               <animate attributeName="r" dur="2s" repeatCount="indefinite" begin="0s" keyTimes="0;0.33;1" values="0;22;44"></animate>
            </circle>
         </g>
         <g>
            <animate attributeName="opacity" dur="2s" repeatCount="indefinite" begin="1s" keyTimes="0;0.33;1" values="1;1;0"></animate>
            <circle cx="50" cy="50" r="40" stroke="#5cffd6" fill="none" stroke-width="6" stroke-linecap="round">
               <animate attributeName="r" dur="2s" repeatCount="indefinite" begin="1s" keyTimes="0;0.33;1" values="0;22;44"></animate>
            </circle>
         </g>
      </svg>
      <span>Séquence en cours...</span>
    </div>
    <div class="row">
      <button class="button-primary" id="start">Start</button>
      <button id="reset" value="yes" disabled>Reset</button>
    </div>
    <div class="row" id="warning">
      <p style="margin-bottom: 0px;"><b>Attention !</b> Veuillez vous écarter de l'objet afin de ne pas interférer avec les capteurs.</p>
    </div>
  </div>
  <div id='footer' style='position: fixed; display: none; width: 100%; text-align:center;'>
    <svg width='20px' height='20px'
        xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" class="uil-blank">
        <rect x="0" y="0" width="100" height="100" fill="none" class="bk"></rect>
        <g transform="scale(0.55)">
            <circle cx="30" cy="150" r="30" fill="#31708f">
                <animate attributeName="opacity" from="0" to="1" dur="0.6s" begin="0" repeatCount="indefinite" keyTimes="0;0.5;1" values="0;1;1"></animate>
            </circle>
            <path d="M90,150h30c0-49.7-40.3-90-90-90v30C63.1,90,90,116.9,90,150z" fill="#31708f">
                <animate attributeName="opacity" from="0" to="1" dur="0.6s" begin="0.06" repeatCount="indefinite" keyTimes="0;0.5;1" values="0;1;1"></animate>
            </path>
            <path d="M150,150h30C180,67.2,112.8,0,30,0v30C96.3,30,150,83.7,150,150z" fill="#31708f">
                <animate attributeName="opacity" from="0" to="1" dur="0.6s" begin="0.12" repeatCount="indefinite" keyTimes="0;0.5;1" values="0;1;1"></animate>
            </path>
        </g>
    </svg>
    <span><b>Uh oh !</b> Tentative de reconnexion au serveur.</span>
  </div>
<!-- End Document
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  
    <script src="/socket.io/socket.io.js"></script>
    
    <script>
      $(document).ready(function() {
        var socket = io();
        
        $('#start').click(function() {
          socket.emit('speed', $('#speed').val());
          $('#speed').val('');
          return false;
        });
        $('#reset').click(function() {
          socket.emit('reset', $('#reset').val());
          $('#reset').val('');
          return false;
        });
        socket.on('disconnect', function(){
          $('#footer').show();
          $('#reset').trigger('click'); 
          $("#start").attr("disabled", "disabled");
        });
        socket.on('connect', function(){
          $('#footer').slideToggle();
          $('#footer').hide();
          $("#start").removeAttr("disabled");
        });
      });
      var rangeSlider = function(){
        var slider = $('.range-slider'),
        range = $('.range-slider__range'),
        value = $('.range-slider__value');

        slider.each(function(){

          value.each(function(){
            var value = $(this).prev().attr('value');
            $(this).html(value);
          });

          range.on('input', function(){
            $(this).next(value).html(this.value);
          });
        });
      };

      rangeSlider();
    </script>
  </body>
</html>
